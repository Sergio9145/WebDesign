<!-- Instagram Clone

Conestoga College, Mobile Solutions Development program

Author: Sergiy Opryshko (#7759145) sopryshko9145@conestogac.on.ca
	
All copyrights reserved. -->

<!doctype html>
<html lang="en" ng-app>
  <head>
    <title>Posts</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- COMMON STYLES -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main_page.css">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    
    <!-- COMMON SCRIPTS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>$(function(){$("#headerContent").load("header.html");});</script>
    <script>$(function(){$("#footerContent").load("footer.html");});</script>
    
    <!-- ONLY FOR THIS PAGE -->
    
    <!-- GET/POST PROCESSING -->
    <script>
    
    /* Function used to update user's page on POST-requests */
    function updateContent(posts){
        //jQuery function to set the innerHTML of the div with id = 'bodyContent' to empty
        $('#bodyContent').html('');
        //loop over each post item in the posts array
        posts.forEach(function(post){
            //jQuery function to append to the innterHTML of the div with id = 'bodyContent'
            $('#bodyContent').append(
                //remember the id in a data-element (we can define as many of our own as needed)
                '<nav class="navbar navbar-default" style="width:490px; margin:20px auto;">' +
				'<div style="margin:20px;">' +
                '<div data-postId="' + post._id + '">' +
                //set the image url in the img tag. This will force the browser to go get it
                '<img src="' + post.image + '"/>' +
                //set the comment into a paragraph
                '<p>Comment: ' + post.comment + '</p>' +
                //set the like count
                '<p>Like Count: ' + 
                //use a span with an id so the javascript can find this easily later
                '<span id ="like' + post._id + '">' + post.likeCount + '</span>' + 
                '</p>' +
                //set up the click event to call likeClick() with the id of this item as a parameter
                '<button onclick="likeClick(\'' + post._id + '\');">Like</button>' +
                '</div></div></nav>'
            );
        });
    }
    //onLoad function, to be executed when page is completed loaded by browser
    function onload(){
        //start a promise chain
        Promise.resolve()
        .then(function(){
            //jQuery function to request all the posts from the server
            //the 'return' is required. Otherwise, the subsequent then will not wait for this to complete
            return $.post('bodyContent');
        })
        //when the server responds, we'll execute this code
        .then(function(posts){
        	return updateContent(posts)
        })
        .catch(function(err){
            //always include a catch for exceptions
            console.log(err);
        });
    } // onload()

    function onAddPost(){
	    //start a promise chain
	    Promise.resolve()
	    .then(function(){
	        //jQuery function to request all the posts from the server
	        //the 'return' is required. Otherwise, the subsequent then will not wait for this to complete
	        return $.post('addPost');
	    })
        //when the server responds, we'll execute this code
        .then(function(posts){
        	return updateContent(posts)
        })
	    .catch(function(err){
	        //always include a catch for exceptions
	        console.log(err);
	    });
    } // onAddPost()
    </script>
</head>

<body onload='onload();'>
    <div id="headerContent"></div>
    
    <div class="container-fluid" style="line-height:30px; margin:15px;"><button type="button" class="btn btn-default navbar-right" onclick="onAddPost()">Add post</button></div>
    
    <div id="bodyContent"></div>
    
    <div id="footerContent"></div>
</body>